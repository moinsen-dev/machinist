{{define "macos-defaults"}}
{{if .Dock}}
log "Configuring Dock"
{{if .Dock.AutoHide}}defaults write com.apple.dock autohide -bool true{{end}}
defaults write com.apple.dock tilesize -int {{.Dock.TileSize}}
defaults write com.apple.dock orientation -string "{{.Dock.Orientation}}"
{{if .Dock.Magnification}}defaults write com.apple.dock magnification -bool true{{end}}
{{if not .Dock.ShowRecents}}defaults write com.apple.dock show-recents -bool false{{end}}
{{end}}

{{if .Finder}}
log "Configuring Finder"
{{if .Finder.ShowPathBar}}defaults write com.apple.finder ShowPathbar -bool true{{end}}
{{if .Finder.ShowStatusBar}}defaults write com.apple.finder ShowStatusBar -bool true{{end}}
{{if .Finder.ShowHidden}}defaults write com.apple.finder AppleShowAllFiles -bool true{{end}}
{{if .Finder.DefaultView}}defaults write com.apple.finder FXPreferredViewStyle -string "{{.Finder.DefaultView}}"{{end}}
{{end}}

{{if .Keyboard}}
log "Configuring Keyboard"
defaults write NSGlobalDomain KeyRepeat -int {{.Keyboard.KeyRepeat}}
defaults write NSGlobalDomain InitialKeyRepeat -int {{.Keyboard.InitialKeyRepeat}}
{{if not .Keyboard.ApplePressAndHoldEnabled}}defaults write NSGlobalDomain ApplePressAndHoldEnabled -bool false{{end}}
{{end}}

{{if .Screenshots}}
log "Configuring Screenshots"
{{if .Screenshots.Path}}defaults write com.apple.screencapture location -string "{{.Screenshots.Path}}"{{end}}
{{if .Screenshots.Format}}defaults write com.apple.screencapture type -string "{{.Screenshots.Format}}"{{end}}
{{if .Screenshots.DisableShadow}}defaults write com.apple.screencapture disable-shadow -bool true{{end}}
{{end}}

{{range .Defaults}}
defaults write {{.Domain}} {{.Key}} -{{.ValueType}} {{.Value}}
{{end}}

log "Restarting affected services..."
killall Dock 2>/dev/null || true
killall Finder 2>/dev/null || true
killall SystemUIServer 2>/dev/null || true
{{end}}
